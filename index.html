<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario de Barridos - Noviembre 2025 - Parque de la Paz</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --teal-principal: #008080;
            --teal-oscuro: #006666;
            --teal-claro: #e0f2f1;
            --teal-medio: #4db6ac;
            --dorado: #FFD700;
            --rojo: #e74c3c;
            --verde: #2ecc71;
            --texto-oscuro: #004d40;
            --blanco: #ffffff;
            --sombra: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f3443 0%, #34e89e 100%);
            color: var(--texto-oscuro);
            line-height: 1.6;
            padding: 15px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 100%;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .calendario-section, .form-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: var(--sombra);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .form-section {
            display: flex;
            flex-direction: column;
        }
        
        header {
            background: linear-gradient(135deg, var(--teal-principal) 0%, var(--teal-oscuro) 100%);
            padding: 20px 15px;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="rgba(255,255,255,0.1)"/></svg>');
            background-size: cover;
        }
        
        h1 {
            color: white;
            margin-bottom: 8px;
            font-size: 1.5rem;
            position: relative;
        }
        
        .subtitle {
            font-size: 1rem;
            font-weight: normal;
            color: white;
            opacity: 0.9;
            position: relative;
        }
        
        .calendario-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: var(--teal-claro);
            border-bottom: 1px solid var(--teal-medio);
        }
        
        .mes-anio {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--teal-oscuro);
        }
        
        .controles-calendario button {
            background: var(--teal-principal);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
            margin-left: 10px;
        }
        
        .controles-calendario button:hover {
            background: var(--teal-oscuro);
            transform: scale(1.1);
        }
        
        .controles-calendario button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .dias-semana {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: var(--teal-principal);
            color: white;
            font-weight: 600;
            text-align: center;
        }
        
        .dia-semana {
            padding: 12px 0;
            font-size: 0.9rem;
        }
        
        .dias-mes {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: var(--teal-claro);
        }
        
        .dia {
            background: white;
            min-height: 80px;
            padding: 8px 5px;
            display: flex;
            flex-direction: column;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }
        
        .dia:hover {
            background: #f5f5f5;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            z-index: 1;
        }
        
        .dia.otro-mes {
            background: #f9f9f9;
            color: #ccc;
        }
        
        .dia.actual {
            background: var(--teal-claro);
            font-weight: 700;
        }
        
        .dia.disponible {
            border-left: 4px solid var(--teal-principal);
        }
        
        .dia.agotado {
            background: #f8d7da;
            border-left: 4px solid var(--rojo);
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .dia.agotado:hover {
            transform: none;
            box-shadow: none;
        }
        
        .dia.sin-barridos {
            background: #f9f9f9;
            cursor: default;
        }
        
        .dia.sin-barridos:hover {
            transform: none;
            box-shadow: none;
        }
        
        .dia.premiacion {
            background: #fff3cd;
            border-left: 4px solid var(--dorado);
            cursor: default;
        }
        
        .dia.premiacion:hover {
            transform: none;
            box-shadow: none;
        }
        
        .numero-dia {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 3px;
        }
        
        .eventos-dia {
            flex-grow: 1;
            font-size: 0.7rem;
        }
        
        .evento {
            background: var(--teal-medio);
            color: white;
            padding: 2px 4px;
            border-radius: 3px;
            margin-bottom: 2px;
            font-size: 0.65rem;
        }
        
        .contador-cupos {
            margin-top: 3px;
            font-size: 0.7rem;
            text-align: center;
            padding: 3px;
            border-radius: 8px;
            font-weight: bold;
        }
        
        .cupos-disponibles {
            background: var(--verde);
            color: white;
        }
        
        .cupos-agotados {
            background: var(--rojo);
            color: white;
        }
        
        .cupos-pocos {
            background: #f39c12;
            color: white;
        }
        
        .premiacion-texto {
            background: var(--dorado);
            color: var(--texto-oscuro);
            font-size: 0.65rem;
            text-align: center;
            padding: 4px;
            border-radius: 8px;
            font-weight: bold;
        }
        
        .horarios-disponibles {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 10px;
        }
        
        .horario-option {
            background: var(--teal-claro);
            border: 1px solid var(--teal-medio);
            border-radius: 6px;
            padding: 10px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .horario-option:hover {
            background: var(--teal-medio);
            color: white;
        }
        
        .horario-option.seleccionado {
            background: var(--teal-principal);
            color: white;
        }
        
        .horario-option.agotado {
            background: #f8d7da;
            color: #721c24;
            cursor: not-allowed;
        }
        
        .horario-option.ya-registrado {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px dashed #0c5460;
            cursor: not-allowed;
        }
        
        .form-content {
            padding: 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--texto-oscuro);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--teal-claro);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--teal-medio);
            box-shadow: 0 0 0 3px rgba(77, 182, 172, 0.2);
        }
        
        .input-error {
            border-color: var(--rojo) !important;
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.2) !important;
        }
        
        .error-message {
            color: var(--rojo);
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
        }
        
        .resumen-registro {
            background: var(--teal-claro);
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
            border-left: 4px solid var(--teal-principal);
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .resumen-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .lista-registros {
            flex-grow: 1;
            overflow-y: auto;
            max-height: 150px;
        }
        
        .registro-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--teal-medio);
        }
        
        .registro-item:last-child {
            border-bottom: none;
        }
        
        .eliminar-item {
            color: #d32f2f;
            cursor: pointer;
            font-weight: bold;
            margin-left: 10px;
            font-size: 1.2rem;
        }
        
        button.registro-btn {
            background: linear-gradient(to right, var(--teal-principal), var(--teal-oscuro));
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 20px;
            box-shadow: 0 4px 10px rgba(0, 128, 128, 0.3);
        }
        
        button.registro-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 128, 128, 0.4);
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .checkbox-group input {
            width: auto;
            margin-right: 10px;
            accent-color: var(--teal-principal);
        }
        
        .admin-section {
            background: var(--teal-claro);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid var(--dorado);
            display: none;
        }
        
        .admin-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .admin-btn {
            background: var(--dorado);
            color: var(--texto-oscuro);
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 120px;
        }
        
        .admin-btn:hover {
            background: #e6c200;
            transform: translateY(-2px);
        }
        
        .admin-btn.rojo {
            background: var(--rojo);
            color: white;
        }
        
        .admin-btn.rojo:hover {
            background: #c0392b;
        }
        
        .admin-access-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--dorado);
            color: var(--texto-oscuro);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transition: all 0.3s;
        }
        
        .admin-access-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }
        
        footer {
            background-color: var(--teal-claro);
            padding: 15px;
            text-align: center;
            font-size: 0.9rem;
            color: var(--texto-oscuro);
            border-top: 1px solid var(--teal-medio);
        }
        
        .footer-info {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }
        
        .footer-contact {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .whatsapp-link {
            color: var(--teal-oscuro);
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
            padding: 5px 10px;
            border-radius: 20px;
            background: rgba(37, 211, 102, 0.1);
        }
        
        .whatsapp-link:hover {
            background: rgba(37, 211, 102, 0.2);
            transform: translateY(-2px);
        }
        
        .badge {
            display: inline-block;
            background: var(--dorado);
            color: var(--texto-oscuro);
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 700;
            margin-left: 5px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 15px;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 20px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            animation: modalAppear 0.3s ease-out;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        @keyframes modalAppear {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--teal-claro);
            padding-bottom: 10px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--teal-oscuro);
        }
        
        .info-cupos {
            background: var(--teal-claro);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .advertencia {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-size: 0.9rem;
            color: #856404;
        }
        
        .texto-mayusculas {
            text-transform: uppercase;
        }
        
        .gps-section {
            padding: 15px;
            background: var(--teal-claro);
            border-top: 1px solid var(--teal-medio);
        }
        
        .gps-title {
            text-align: center;
            margin-bottom: 15px;
            color: var(--teal-oscuro);
            font-size: 1.3rem;
            font-weight: 700;
        }
        
        .gps-table-container {
            width: 100%;
            overflow-x: auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .gps-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
        }
        
        .gps-table th {
            background: var(--teal-principal);
            color: white;
            padding: 10px 6px;
            text-align: center;
            font-weight: 600;
            font-size: 0.8rem;
        }
        
        .gps-table td {
            padding: 8px 6px;
            text-align: center;
            border-bottom: 1px solid var(--teal-claro);
            font-size: 0.75rem;
        }
        
        .gps-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .gps-table tr:hover {
            background: var(--teal-claro);
        }
        
        .gps-link {
            color: var(--teal-oscuro);
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 3px;
            transition: color 0.3s;
            font-size: 0.75rem;
        }
        
        .gps-link:hover {
            color: var(--teal-principal);
            text-decoration: underline;
        }
        
        .sector-title {
            font-weight: 600;
            color: var(--teal-oscuro);
        }
        
        .fecha-barrido {
            font-size: 0.7rem;
            color: #666;
            font-weight: 500;
        }
        
        .mes-no-disponible {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .mes-no-disponible i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #ccc;
        }
        
        .eliminacion-rapida {
            background: #fff3cd;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid #f39c12;
        }
        
        .eliminacion-form {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .eliminacion-form input {
            flex-grow: 1;
        }
        
        .eliminacion-form button {
            background: var(--rojo);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .eliminacion-form button:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        .reseteo-cupos {
            background: #d1ecf1;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid #0c5460;
        }
        
        .reseteo-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .reseteo-btn {
            background: #0c5460;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            flex: 1;
            min-width: 120px;
        }
        
        .reseteo-btn:hover {
            background: #083038;
            transform: translateY(-2px);
        }
        
        @media (min-width: 768px) {
            .container {
                max-width: 1400px;
                margin: 0 auto;
                grid-template-columns: 1fr 400px;
                display: grid;
            }
            
            .footer-info {
                flex-direction: row;
                gap: 10px;
            }
            
            .gps-table th,
            .gps-table td {
                padding: 10px 8px;
                font-size: 0.8rem;
            }
            
            .gps-link {
                font-size: 0.8rem;
            }
            
            .fecha-barrido {
                font-size: 0.75rem;
            }
            
            .admin-buttons {
                flex-direction: row;
            }
            
            .eliminacion-form {
                flex-direction: row;
            }
            
            .reseteo-buttons {
                flex-direction: row;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <section class="calendario-section">
            <header>
                <h1>CALENDARIO DE BARRIDOS</h1>
                <p class="subtitle">Noviembre 2025 - Parque de la Paz</p>
            </header>
            
            <div class="calendario-header">
                <div class="mes-anio" id="mesAnio">Noviembre 2025</div>
                <div class="controles-calendario">
                    <button id="prevMes"><i class="fas fa-chevron-left"></i></button>
                    <button id="nextMes"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
            
            <div class="dias-semana">
                <div class="dia-semana">Dom</div>
                <div class="dia-semana">Lun</div>
                <div class="dia-semana">Mar</div>
                <div class="dia-semana">Mi√©</div>
                <div class="dia-semana">Jue</div>
                <div class="dia-semana">Vie</div>
                <div class="dia-semana">S√°b</div>
            </div>
            
            <div class="dias-mes" id="diasMes">
                <!-- Los d√≠as se generar√°n con JavaScript -->
            </div>
            
            <!-- Tabla de Puntos GPS -->
            <div class="gps-section">
                <h2 class="gps-title">PUNTOS GPS SECTORES</h2>
                <div class="gps-table-container">
                    <table class="gps-table">
                        <thead>
                            <tr>
                                <th># BARRIDO</th>
                                <th>FECHA</th>
                                <th>MA√ëANA</th>
                                <th>DIRECCI√ìN</th>
                                <th>GPS</th>
                                <th>TARDE</th>
                                <th>DIRECCI√ìN</th>
                                <th>GPS</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="sector-title">BIZ - 1</td>
                                <td class="fecha-barrido">10 Nov</td>
                                <td>09:00 - 12:00</td>
                                <td>BOYAC√Å</td>
                                <td><a href="https://maps.app.goo.gl/g77pSMT7x1wTxFU3A" target="_blank" class="gps-link"><i class="fas fa-map-marker-alt"></i> Ver Mapa</a></td>
                                <td>14:30 - 17:30</td>
                                <td>SAUCES 8</td>
                                <td><a href="https://maps.app.goo.gl/ujjSUP9NXfKyiKbM9" target="_blank" class="gps-link"><i class="fas fa-map-marker-alt"></i> Ver Mapa</a></td>
                            </tr>
                            <!-- M√°s filas de la tabla GPS aqu√≠ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
        
        <section class="form-section">
            <header>
                <h1>REGISTRO</h1>
                <p class="subtitle">Complete sus datos</p>
            </header>
            
            <div class="form-content">
                <div class="info-cupos">
                    <h3><i class="fas fa-users"></i> Cupos Disponibles</h3>
                    <p>Cada d√≠a tiene <strong>10 cupos</strong> por horario</p>
                    <p id="estadoCupos">Selecciona un d√≠a para ver disponibilidad</p>
                </div>
                
                <div class="advertencia">
                    <i class="fas fa-exclamation-triangle"></i> 
                    <strong>Importante:</strong> No puedes registrarte dos veces en el mismo d√≠a y horario
                </div>
                
                <div class="form-group">
                    <label for="codigoAsesor">C√≥digo de Asesor *</label>
                    <input type="text" id="codigoAsesor" name="codigoAsesor" required placeholder="Tu c√≥digo √∫nico de asesor">
                    <small style="color: #666;">Este c√≥digo identifica tu registro de forma √∫nica</small>
                </div>
                
                <div class="form-group">
                    <label for="nombre">Nombre completo *</label>
                    <input type="text" id="nombre" name="nombre" required placeholder="INGRESA TU NOMBRE COMPLETO" class="texto-mayusculas">
                </div>
                
                <div class="form-group">
                    <label for="telefono">Tel√©fono *</label>
                    <input type="tel" id="telefono" name="telefono" required placeholder="0XXXXXXXXX" maxlength="10">
                    <div class="error-message" id="telefonoError">El tel√©fono debe tener 10 d√≠gitos num√©ricos y comenzar con 0</div>
                    <small style="color: #666;">Formato: 0 + 9 d√≠gitos (Ej: 0960601592)</small>
                </div>
                
                <div class="form-group">
                    <label for="email">Correo electr√≥nico *</label>
                    <input type="email" id="email" name="email" required placeholder="ejemplo@correo.com">
                </div>
                
                <div class="form-group">
                    <label for="equipo">Equipo al que pertenece *</label>
                    <select id="equipo" name="equipo" required>
                        <option value="">-- Selecciona tu equipo --</option>
                        <option value="ASTILLERO">ASTILLERO</option>
                        <option value="AUTOGESTION">AUTOGESTI√ìN</option>
                        <option value="CAPACITACION">CAPACITACI√ìN</option>
                        <option value="DIGITAL">DIGITAL</option>
                        <option value="IMPETU">IMPETU</option>
                        <option value="LEGENDARIOS">LEGENDARIOS</option>
                        <option value="MILENIUM">MILENIUM</option>
                        <option value="NUEVO AMANECER">NUEVO AMANECER</option>
                        <option value="PERLA">PERLA</option>
                        <option value="RA√çCES">RA√çCES</option>
                        <option value="RENOVACI√ìN">RENOVACI√ìN</option>
                        <option value="RENTABILIZACION">RENTABILIZACI√ìN</option>
                        <option value="ROBLES">ROBLES</option>
                        <option value="TURNOS">TURNOS</option>
                        <option value="VISIONARIOS">VISIONARIOS</option>
                    </select>
                </div>
                
                <div class="resumen-registro">
                    <div class="resumen-header">
                        <h3>Barridos Seleccionados</h3>
                        <span class="badge" id="contadorRegistros">0</span>
                    </div>
                    <div class="lista-registros" id="listaRegistros">
                        <!-- Los registros aparecer√°n aqu√≠ -->
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="confirmacion" name="confirmacion" required>
                        <label for="confirmacion">Confirmo que asistir√© a los barridos seleccionados</label>
                    </div>
                </div>
                
                <button type="submit" class="registro-btn" id="registroBtn">
                    <i class="fas fa-calendar-check"></i> REGISTRARME
                </button>
                
                <!-- Secci√≥n de Administraci√≥n (oculta por defecto) -->
                <div class="admin-section" id="adminSection">
                    <h3><i class="fas fa-cog"></i> Panel de Administraci√≥n</h3>
                    <p>Funciones administrativas para gestionar los registros</p>
                    
                    <!-- Eliminaci√≥n r√°pida de registros -->
                    <div class="eliminacion-rapida">
                        <h4><i class="fas fa-trash-alt"></i> Eliminaci√≥n R√°pida</h4>
                        <p>Elimina un registro por c√≥digo de asesor:</p>
                        <div class="eliminacion-form">
                            <input type="text" id="codigoEliminar" placeholder="C√≥digo de asesor a eliminar">
                            <button id="btnEliminarRapido">Eliminar</button>
                        </div>
                    </div>
                    
                    <!-- Reseteo de cupos -->
                    <div class="reseteo-cupos">
                        <h4><i class="fas fa-redo-alt"></i> Reseteo de Cupos</h4>
                        <p>Restablece los cupos a su estado inicial:</p>
                        <div class="reseteo-buttons">
                            <button class="reseteo-btn" id="reseteoCuposDia">
                                <i class="fas fa-calendar-day"></i> Reseteo por D√≠a
                            </button>
                            <button class="reseteo-btn" id="reseteoCuposCompleto">
                                <i class="fas fa-calendar-week"></i> Reseteo Completo
                            </button>
                        </div>
                    </div>
                    
                    <div class="admin-buttons">
                        <button class="admin-btn" id="descargarRegistros">
                            <i class="fas fa-file-excel"></i> Descargar Excel
                        </button>
                        <button class="admin-btn" id="descargarResumen">
                            <i class="fas fa-chart-bar"></i> Resumen por Equipo
                        </button>
                        <button class="admin-btn" id="eliminarRegistro">
                            <i class="fas fa-trash-alt"></i> Eliminar Registro
                        </button>
                        <button class="admin-btn rojo" id="cerrarSesion">
                            <i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n
                        </button>
                    </div>
                </div>
            </div>
            
            <footer>
                <div class="footer-info">
                    <span>¬© 2025 Parque de la Paz |</span>
                    <div class="footer-contact">
                        <span>RESPONSABLE Jonathan Sol√≥rzano</span>
                        <i class="fas fa-phone"></i>
                        <a href="https://wa.me/593960601592?text=Hola%20Jonathan,%20me%20interesa%20obtener%20m√°s%20informaci√≥n%20sobre%20los%20barridos%20del%20Parque%20de%20la%20Paz" target="_blank" class="whatsapp-link">
                            <i class="fab fa-whatsapp"></i> 0960601592
                        </a>
                    </div>
                </div>
            </footer>
        </section>
    </div>
    
    <!-- Bot√≥n de acceso administrativo (flotante) -->
    <button class="admin-access-btn" id="adminAccessBtn" title="Acceso Administrativo">
        <i class="fas fa-lock"></i>
    </button>
    
    <!-- Modal para selecci√≥n de horarios -->
    <div class="modal" id="modalHorarios">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitulo">Seleccionar Horarios</h2>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <div id="modalBody">
                <!-- Contenido del modal se generar√° din√°micamente -->
            </div>
        </div>
    </div>

    <!-- Modal para autenticaci√≥n de administrador -->
    <div class="modal" id="adminAuthModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Acceso Administrativo</h2>
                <button class="close-modal" id="closeAuthModal">&times;</button>
            </div>
            <div>
                <div class="form-group">
                    <label for="adminPassword">Contrase√±a de Administrador</label>
                    <input type="password" id="adminPassword" placeholder="Ingresa la contrase√±a">
                    <small style="color: #666;">Solo el administrador autorizado puede acceder</small>
                </div>
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button id="cancelAuth" style="flex: 1; padding: 10px; background: #f5f5f5; border: 1px solid #ddd; border-radius: 5px; cursor: pointer;">Cancelar</button>
                    <button id="submitAuth" style="flex: 1; padding: 10px; background: var(--teal-principal); color: white; border: none; border-radius: 5px; cursor: pointer;">Acceder</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para eliminar registros -->
    <div class="modal" id="eliminarRegistroModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Eliminar Registro</h2>
                <button class="close-modal" id="closeEliminarModal">&times;</button>
            </div>
            <div>
                <div class="form-group">
                    <label for="buscarCodigo">C√≥digo de Asesor a Eliminar</label>
                    <input type="text" id="buscarCodigo" placeholder="Ingresa el c√≥digo de asesor">
                </div>
                <div id="resultadosBusqueda" style="margin-top: 15px; max-height: 300px; overflow-y: auto;">
                    <!-- Los resultados de b√∫squeda aparecer√°n aqu√≠ -->
                </div>
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button id="cancelarEliminar" style="flex: 1; padding: 10px; background: #f5f5f5; border: 1px solid #ddd; border-radius: 5px; cursor: pointer;">Cancelar</button>
                    <button id="buscarRegistro" style="flex: 1; padding: 10px; background: var(--teal-principal); color: white; border: none; border-radius: 5px; cursor: pointer;">Buscar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para reseteo de cupos por d√≠a -->
    <div class="modal" id="reseteoCuposModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Reseteo de Cupos por D√≠a</h2>
                <button class="close-modal" id="closeReseteoModal">&times;</button>
            </div>
            <div>
                <div class="form-group">
                    <label for="diaReseteo">Selecciona el d√≠a a resetear:</label>
                    <select id="diaReseteo">
                        <option value="">-- Selecciona un d√≠a --</option>
                        <!-- Las opciones se generar√°n din√°micamente -->
                    </select>
                </div>
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button id="cancelarReseteo" style="flex: 1; padding: 10px; background: #f5f5f5; border: 1px solid #ddd; border-radius: 5px; cursor: pointer;">Cancelar</button>
                    <button id="confirmarReseteo" style="flex: 1; padding: 10px; background: var(--teal-principal); color: white; border: none; border-radius: 5px; cursor: pointer;">Resetear</button>
                </div>
            </div>
        </div>
    </div>
   <script>
    // Configuraci√≥n - REEMPLAZA CON TU URL DE APPS SCRIPT
    const GOOGLE_APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzi_F4o3NvxgoF3QmOb94HN-Z0Emnk9a0YRILtfY3Ne78ouyo3Z0qvsy-KbI4oWZvYn/exec";

    // Funci√≥n para probar la conexi√≥n
    async function probarConexion() {
        try {
            const response = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?action=test`);
            const result = await response.json();
            console.log('Conexi√≥n exitosa:', result);
            return true;
        } catch (error) {
            console.error('Error de conexi√≥n:', error);
            return false;
        }
    }

       function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    
    if (data.action === 'guardarRegistro') {
      // Tu c√≥digo para guardar en Google Sheets
      return ContentService.createTextOutput(JSON.stringify({
        success: true,
        message: 'Registro guardado exitosamente'
      })).setMimeType(ContentService.MimeType.JSON);
    }
    
    if (data.action === 'test') {
      return ContentService.createTextOutput(JSON.stringify({
        success: true,
        message: 'Conexi√≥n exitosa'
      })).setMimeType(ContentService.MimeType.JSON);
    }
    
  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({
      success: false,
      message: 'Error: ' + error.toString()
    })).setMimeType(ContentService.MimeType.JSON);
  }
}

function doGet(e) {
  if (e.parameter.action === 'test') {
    return ContentService.createTextOutput(JSON.stringify({
      success: true,
      message: 'Conexi√≥n GET exitosa'
    })).setMimeType(ContentService.MimeType.JSON);
  }
}

    // Funci√≥n para preparar datos para Google Sheets
    function prepararDatosParaSheets(datosRegistro) {
        // Crear un registro por cada barrido seleccionado
        const registrosParaSheets = datosRegistro.registros.map(barrido => {
            return {
                codigoAsesor: datosRegistro.codigoAsesor,
                nombre: datosRegistro.nombre,
                telefono: datosRegistro.telefono,
                email: datosRegistro.email,
                equipo: datosRegistro.equipo,
                fechaBarrido: barrido.fecha,
                fechaBarridoTexto: barrido.fechaTexto,
                horario: barrido.horario,
                tipoHorario: barrido.tipoHorario,
                fechaRegistro: new Date().toLocaleString('es-ES'),
                timestamp: new Date().toISOString()
            };
        });
        
        return registrosParaSheets;
    }

// Funci√≥n para guardar registro en Google Sheets - MEJORADA
async function guardarRegistroEnSheets(datosRegistro) {
    try {
        const registrosParaSheets = prepararDatosParaSheets(datosRegistro);
        
        console.log('Enviando datos a Google Sheets:', registrosParaSheets);
        
        const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                action: 'guardarRegistro',
                registros: registrosParaSheets
            })
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        console.log('Respuesta de Google Sheets:', result);
        return result;
        
    } catch (error) {
        console.error('Error detallado al guardar en Sheets:', error);
        
        // Proporcionar m√°s informaci√≥n sobre el error
        let mensajeError = 'Error de conexi√≥n: ' + error.message;
        
        if (error.message.includes('Failed to fetch')) {
            mensajeError += '\n\nPosibles causas:\n' +
                           '‚Ä¢ URL de Google Apps Script incorrecta\n' +
                           '‚Ä¢ Apps Script no desplegado correctamente\n' +
                           '‚Ä¢ Problemas de CORS\n' +
                           '‚Ä¢ La aplicaci√≥n web no est√° configurada para "Cualquier persona"';
        }
        
        return { 
            success: false, 
            message: mensajeError 
        };
    }
}

       // Funci√≥n para probar la conexi√≥n con Google Apps Script
async function probarConexionGoogleAppsScript() {
    try {
        console.log('Probando conexi√≥n con:', GOOGLE_APPS_SCRIPT_URL);
        
        const response = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?action=test`, {
            method: 'GET',
            mode: 'no-cors' // Intenta con no-cors primero
        });
        
        console.log('Respuesta de prueba:', response);
        return true;
    } catch (error) {
        console.log('Error en prueba de conexi√≥n:', error);
        
        // Intenta con una solicitud POST simple
        try {
            const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ action: 'test' })
            });
            console.log('Respuesta POST de prueba:', response);
            return true;
        } catch (postError) {
            console.log('Error en prueba POST:', postError);
            return false;
        }
    }
}



    // Funci√≥n para obtener cupos
    async function obtenerCupos() {
        try {
            const response = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?action=getCupos`);
            const result = await response.json();
            return result;
        } catch (error) {
            console.error('Error al obtener cupos:', error);
            // Cupos por defecto
            const cuposPorDefecto = {};
            const diasConBarridos = [10, 12, 13, 14, 17, 18, 19, 20, 21, 24, 25, 26];
            diasConBarridos.forEach(dia => {
                const fechaStr = `2025-11-${dia.toString().padStart(2, '0')}`;
                cuposPorDefecto[fechaStr] = { manana: 10, tarde: 10 };
            });
            return cuposPorDefecto;
        }
    }

    // Modificar la funci√≥n obtenerCuposDia para usar la API
    async function obtenerCuposDia(fechaStr) {
        const cupos = await obtenerCupos();
        return cupos[fechaStr] || { manana: 10, tarde: 10 };
    }

    document.addEventListener('DOMContentLoaded', function() {

        const conexionExitosa = await probarConexionGoogleAppsScript();
        if (!conexionExitosa) {
            console.warn('‚ö†Ô∏è No se pudo conectar con Google Apps Script. Los datos se guardar√°n solo localmente.');
        }
        
        // Elementos del DOM
        const diasMes = document.getElementById('diasMes');
        const mesAnio = document.getElementById('mesAnio');
        const prevMesBtn = document.getElementById('prevMes');
        const nextMesBtn = document.getElementById('nextMes');
        const modalHorarios = document.getElementById('modalHorarios');
        const closeModal = document.getElementById('closeModal');
        const modalTitulo = document.getElementById('modalTitulo');
        const modalBody = document.getElementById('modalBody');
        const listaRegistros = document.getElementById('listaRegistros');
        const contadorRegistros = document.getElementById('contadorRegistros');
        const registroBtn = document.getElementById('registroBtn');
        const estadoCupos = document.getElementById('estadoCupos');
        const codigoAsesorInput = document.getElementById('codigoAsesor');
        const nombreInput = document.getElementById('nombre');
        const telefonoInput = document.getElementById('telefono');
        const telefonoError = document.getElementById('telefonoError');
        const equipoSelect = document.getElementById('equipo');
        const descargarRegistrosBtn = document.getElementById('descargarRegistros');
        const descargarResumenBtn = document.getElementById('descargarResumen');
        const eliminarRegistroBtn = document.getElementById('eliminarRegistro');
        const cerrarSesionBtn = document.getElementById('cerrarSesion');
        const adminSection = document.getElementById('adminSection');
        const adminAccessBtn = document.getElementById('adminAccessBtn');
        const adminAuthModal = document.getElementById('adminAuthModal');
        const adminPasswordInput = document.getElementById('adminPassword');
        const closeAuthModal = document.getElementById('closeAuthModal');
        const cancelAuth = document.getElementById('cancelAuth');
        const submitAuth = document.getElementById('submitAuth');
        const eliminarRegistroModal = document.getElementById('eliminarRegistroModal');
        const buscarCodigoInput = document.getElementById('buscarCodigo');
        const resultadosBusqueda = document.getElementById('resultadosBusqueda');
        const closeEliminarModal = document.getElementById('closeEliminarModal');
        const cancelarEliminar = document.getElementById('cancelarEliminar');
        const buscarRegistroBtn = document.getElementById('buscarRegistro');
        const codigoEliminarInput = document.getElementById('codigoEliminar');
        const btnEliminarRapido = document.getElementById('btnEliminarRapido');
        const reseteoCuposDiaBtn = document.getElementById('reseteoCuposDia');
        const reseteoCuposCompletoBtn = document.getElementById('reseteoCuposCompleto');
        const reseteoCuposModal = document.getElementById('reseteoCuposModal');
        const diaReseteoSelect = document.getElementById('diaReseteo');
        const closeReseteoModal = document.getElementById('closeReseteoModal');
        const cancelarReseteo = document.getElementById('cancelarReseteo');
        const confirmarReseteo = document.getElementById('confirmarReseteo');
        
        // üîê CONFIGURACI√ìN DE SEGURIDAD - CAMBIA ESTA CONTRASE√ëA
        const ADMIN_PASSWORD = "admin123"; // Cambia esta contrase√±a por una m√°s segura
        
        // Fecha actual - Noviembre 2025
        let fechaActual = new Date(2025, 10, 1);
        
        // D√≠as con barridos disponibles en noviembre 2025
        const diasConBarridos = [10, 12, 13, 14, 17, 18, 19, 20, 21, 24, 25, 26];
        const diaPremiacion = 11;
        
        // Estado de autenticaci√≥n
        let isAuthenticated = false;
        
        // Verificar si hay una sesi√≥n activa
        function checkAuthStatus() {
            const authStatus = localStorage.getItem('adminAuth2025');
            if (authStatus && authStatus === 'true') {
                isAuthenticated = true;
                showAdminSection();
            }
        }
        
        // Mostrar secci√≥n de administraci√≥n
        function showAdminSection() {
            adminSection.style.display = 'block';
            adminAccessBtn.innerHTML = '<i class="fas fa-unlock"></i>';
            adminAccessBtn.title = 'Acceso Administrativo (Activo)';
            adminAccessBtn.style.background = '#4CAF50';
        }
        
        // Ocultar secci√≥n de administraci√≥n
        function hideAdminSection() {
            adminSection.style.display = 'none';
            adminAccessBtn.innerHTML = '<i class="fas fa-lock"></i>';
            adminAccessBtn.title = 'Acceso Administrativo';
            adminAccessBtn.style.background = 'var(--dorado)';
        }
        
        // Cerrar sesi√≥n administrativa
        function logoutAdmin() {
            isAuthenticated = false;
            localStorage.removeItem('adminAuth2025');
            hideAdminSection();
            alert('Sesi√≥n administrativa cerrada');
        }
        
        // Inicializar cupos si no existen
        function inicializarCupos() {
            if (!localStorage.getItem('cuposBarridos2025')) {
                const cuposIniciales = {};
                diasConBarridos.forEach(dia => {
                    cuposIniciales[`2025-11-${dia.toString().padStart(2, '0')}`] = {
                        manana: 10,
                        tarde: 10
                    };
                });
                localStorage.setItem('cuposBarridos2025', JSON.stringify(cuposIniciales));
            }
        }
        
        // Inicializar registros de asesores si no existen
        if (!localStorage.getItem('registrosAsesores2025')) {
            localStorage.setItem('registrosAsesores2025', JSON.stringify({}));
        }
        
        // Inicializar registros completos si no existen
        if (!localStorage.getItem('registrosCompletos2025')) {
            localStorage.setItem('registrosCompletos2025', JSON.stringify([]));
        }
        
        // Convertir texto a may√∫sculas autom√°ticamente
        nombreInput.addEventListener('input', function() {
            this.value = this.value.toUpperCase();
        });
        
        // Validaci√≥n de tel√©fono
        function validarTelefono(telefono) {
            const regex = /^0\d{9}$/;
            return regex.test(telefono);
        }
        
        // Eventos para validaci√≥n de tel√©fono
        telefonoInput.addEventListener('input', function() {
            const valor = this.value;
            this.value = valor.replace(/[^0-9]/g, '');
            
            if (valor.length === 0) {
                this.value = '0';
            } else if (valor.length === 1 && valor !== '0') {
                this.value = '0' + valor;
            }
            
            if (this.value.length > 10) {
                this.value = this.value.slice(0, 10);
            }
            
            if (validarTelefono(this.value)) {
                this.classList.remove('input-error');
                telefonoError.style.display = 'none';
            } else {
                this.classList.add('input-error');
                telefonoError.style.display = 'block';
            }
        });
        
        telefonoInput.addEventListener('blur', function() {
            if (!validarTelefono(this.value)) {
                this.classList.add('input-error');
                telefonoError.style.display = 'block';
            }
        });
        
        // Verificar si es noviembre 2025
        function esNoviembre2025(fecha) {
            return fecha.getMonth() === 10 && fecha.getFullYear() === 2025;
        }
        
        // Generar calendario
        function generarCalendario() {
            diasMes.innerHTML = '';
            const opciones = { month: 'long', year: 'numeric' };
            mesAnio.textContent = fechaActual.toLocaleDateString('es-ES', opciones);
            
            prevMesBtn.disabled = fechaActual.getMonth() === 10 && fechaActual.getFullYear() === 2025;
            nextMesBtn.disabled = fechaActual.getMonth() === 10 && fechaActual.getFullYear() === 2025;
            
            if (!esNoviembre2025(fechaActual)) {
                diasMes.innerHTML = `
                    <div class="mes-no-disponible">
                        <i class="fas fa-calendar-times"></i>
                        <h3>No hay barridos programados</h3>
                        <p>Actualmente solo est√° disponible la programaci√≥n para Noviembre 2025.</p>
                    </div>
                `;
                return;
            }
            
            const primerDia = new Date(fechaActual.getFullYear(), fechaActual.getMonth(), 1);
            const ultimoDia = new Date(fechaActual.getFullYear(), fechaActual.getMonth() + 1, 0);
            const diaInicio = primerDia.getDay();
            
            for (let i = 0; i < diaInicio; i++) {
                const diaElement = document.createElement('div');
                diaElement.className = 'dia otro-mes';
                diasMes.appendChild(diaElement);
            }
            
            for (let i = 1; i <= ultimoDia.getDate(); i++) {
                const diaElement = document.createElement('div');
                diaElement.className = 'dia';
                
                const hoy = new Date();
                if (fechaActual.getMonth() === 10 && fechaActual.getFullYear() === 2025 && 
                    i === hoy.getDate() && hoy.getMonth() === 10 && hoy.getFullYear() === 2025) {
                    diaElement.classList.add('actual');
                }
                
                if (i === diaPremiacion) {
                    diaElement.classList.add('premiacion');
                } else if (diasConBarridos.includes(i)) {
                    diaElement.classList.add('disponible');
                    const fechaStr = `2025-11-${i.toString().padStart(2, '0')}`;
                    const cuposDia = obtenerCuposDia(fechaStr);
                    
                    if (cuposDia.manana <= 0 && cuposDia.tarde <= 0) {
                        diaElement.classList.add('agotado');
                    }
                } else {
                    diaElement.classList.add('sin-barridos');
                }
                
                const numeroDia = document.createElement('div');
                numeroDia.className = 'numero-dia';
                numeroDia.textContent = i;
                diaElement.appendChild(numeroDia);
                
                if (i === diaPremiacion) {
                    const premiacionTexto = document.createElement('div');
                    premiacionTexto.className = 'premiacion-texto';
                    premiacionTexto.textContent = 'PREMIACI√ìN PDLP';
                    diaElement.appendChild(premiacionTexto);
                    diaElement.style.cursor = 'default';
                } else if (diasConBarridos.includes(i)) {
                    const fechaStr = `2025-11-${i.toString().padStart(2, '0')}`;
                    const cuposDia = obtenerCuposDia(fechaStr);
                    
                    const contadorCupos = document.createElement('div');
                    let claseCupos = 'cupos-disponibles';
                    let textoCupos = '';
                    
                    if (cuposDia.manana <= 0 && cuposDia.tarde <= 0) {
                        claseCupos = 'cupos-agotados';
                        textoCupos = 'CUPOS AGOTADOS';
                    } else {
                        const totalCupos = cuposDia.manana + cuposDia.tarde;
                        if (totalCupos <= 3) {
                            claseCupos = 'cupos-pocos';
                        }
                        textoCupos = `${cuposDia.manana}M ${cuposDia.tarde}T`;
                    }
                    
                    contadorCupos.className = `contador-cupos ${claseCupos}`;
                    contadorCupos.textContent = textoCupos;
                    diaElement.appendChild(contadorCupos);
                    
                    if (cuposDia.manana > 0 || cuposDia.tarde > 0) {
                        diaElement.style.cursor = 'pointer';
                        diaElement.addEventListener('click', function() {
                            abrirModalHorarios(i);
                        });
                    } else {
                        diaElement.style.cursor = 'not-allowed';
                    }
                }
                
                diasMes.appendChild(diaElement);
            }
        }
        
        // Obtener cupos para un d√≠a espec√≠fico
        function obtenerCuposDia(fechaStr) {
            const cuposBarridos = JSON.parse(localStorage.getItem('cuposBarridos2025') || '{}');
            return cuposBarridos[fechaStr] || { manana: 10, tarde: 10 };
        }
        
        // Verificar si el asesor ya est√° registrado
        function asesorYaRegistrado(codigoAsesor, fechaStr, tipoHorario) {
            const registrosAsesores = JSON.parse(localStorage.getItem('registrosAsesores2025') || '{}');
            if (!registrosAsesores[codigoAsesor]) return false;
            return registrosAsesores[codigoAsesor].some(registro => 
                registro.fecha === fechaStr && registro.tipoHorario === tipoHorario
            );
        }
        
        // Obtener horarios ya registrados por el asesor
        function obtenerHorariosRegistradosAsesor(codigoAsesor, fechaStr) {
            const registrosAsesores = JSON.parse(localStorage.getItem('registrosAsesores2025') || '{}');
            const horariosRegistrados = [];
            if (registrosAsesores[codigoAsesor]) {
                registrosAsesores[codigoAsesor].forEach(registro => {
                    if (registro.fecha === fechaStr) {
                        horariosRegistrados.push(registro.tipoHorario);
                    }
                });
            }
            return horariosRegistrados;
        }
        
        // Actualizar cupos para un d√≠a espec√≠fico
        function actualizarCuposDia(fechaStr, horario, cantidad) {
            const cuposBarridos = JSON.parse(localStorage.getItem('cuposBarridos2025') || '{}');
            if (!cuposBarridos[fechaStr]) {
                cuposBarridos[fechaStr] = { manana: 10, tarde: 10 };
            }
            cuposBarridos[fechaStr][horario] = Math.max(0, cuposBarridos[fechaStr][horario] - cantidad);
            localStorage.setItem('cuposBarridos2025', JSON.stringify(cuposBarridos));
            generarCalendario();
        }
        
        // Abrir modal para seleccionar horarios
        function abrirModalHorarios(dia) {
            const codigoAsesor = codigoAsesorInput.value.trim();
            
            if (!codigoAsesor) {
                alert('Por favor ingresa tu c√≥digo de asesor antes de seleccionar horarios');
                codigoAsesorInput.focus();
                return;
            }
            
            const fecha = new Date(2025, 10, dia);
            const opciones = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
            const fechaFormateada = fecha.toLocaleDateString('es-ES', opciones);
            const fechaStr = fecha.toISOString().split('T')[0];
            
            const cuposDia = obtenerCuposDia(fechaStr);
            const horariosYaRegistrados = obtenerHorariosRegistradosAsesor(codigoAsesor, fechaStr);
            
            modalTitulo.textContent = `Barridos - ${fechaFormateada}`;
            
            modalBody.innerHTML = `
                <div style="margin-bottom: 15px;">
                    <p><strong>Cupos disponibles:</strong></p>
                    <p>Ma√±ana: ${cuposDia.manana}/10 | Tarde: ${cuposDia.tarde}/10</p>
                </div>
                <p>Selecciona los horarios para el ${fechaFormateada}:</p>
                <div class="horarios-disponibles" style="margin-top: 15px;">
                    <div class="horario-option ${cuposDia.manana <= 0 ? 'agotado' : ''} ${horariosYaRegistrados.includes('manana') ? 'ya-registrado' : ''}" 
                         data-horario="manana" data-cupos="${cuposDia.manana}">
                        <strong>MA√ëANA</strong><br>
                        09:00 - 12:00<br>
                        (Centro / Sur)<br>
                        <small>Cupos: ${cuposDia.manana}/10</small>
                        ${horariosYaRegistrados.includes('manana') ? '<br><small style="color: #0c5460;"><i class="fas fa-info-circle"></i> Ya est√°s registrado</small>' : ''}
                    </div>
                    <div class="horario-option ${cuposDia.tarde <= 0 ? 'agotado' : ''} ${horariosYaRegistrados.includes('tarde') ? 'ya-registrado' : ''}" 
                         data-horario="tarde" data-cupos="${cuposDia.tarde}">
                        <strong>TARDE</strong><br>
                        14:30 - 17:30<br>
                        (Norte)<br>
                        <small>Cupos: ${cuposDia.tarde}/10</small>
                        ${horariosYaRegistrados.includes('tarde') ? '<br><small style="color: #0c5460;"><i class="fas fa-info-circle"></i> Ya est√°s registrado</small>' : ''}
                    </div>
                </div>
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button id="cancelarHorarios" style="flex: 1; padding: 10px; background: #f5f5f5; border: 1px solid #ddd; border-radius: 5px; cursor: pointer;">Cancelar</button>
                    <button id="guardarHorarios" style="flex: 1; padding: 10px; background: var(--teal-principal); color: white; border: none; border-radius: 5px; cursor: pointer;">Guardar Selecci√≥n</button>
                </div>
            `;
            
            const horariosOptions = modalBody.querySelectorAll('.horario-option:not(.agotado):not(.ya-registrado)');
            horariosOptions.forEach(option => {
                option.addEventListener('click', function() {
                    this.classList.toggle('seleccionado');
                });
            });
            
            modalBody.querySelector('#cancelarHorarios').addEventListener('click', function() {
                modalHorarios.style.display = 'none';
            });
            
            modalBody.querySelector('#guardarHorarios').addEventListener('click', function() {
                const horariosSeleccionados = modalBody.querySelectorAll('.horario-option.seleccionado');
                if (horariosSeleccionados.length === 0) {
                    alert('Por favor selecciona al menos un horario');
                    return;
                }
                
                for (const horario of horariosSeleccionados) {
                    const tipoHorario = horario.getAttribute('data-horario');
                    const cuposDisponibles = parseInt(horario.getAttribute('data-cupos'));
                    
                    if (cuposDisponibles <= 0) {
                        alert(`No hay cupos disponibles para el horario de ${tipoHorario}`);
                        return;
                    }
                    
                    if (asesorYaRegistrado(codigoAsesor, fechaStr, tipoHorario)) {
                        alert(`Ya est√°s registrado en el horario de ${tipoHorario} para este d√≠a`);
                        return;
                    }
                }
                
                horariosSeleccionados.forEach(horario => {
                    const tipoHorario = horario.getAttribute('data-horario');
                    const horarioTexto = tipoHorario === 'manana' ? '09:00 - 12:00 (Centro / Sur)' : '14:30 - 17:30 (Norte)';
                    
                    actualizarCuposDia(fechaStr, tipoHorario, 1);
                    
                    const registros = JSON.parse(localStorage.getItem('registrosBarridos2025') || '[]');
                    registros.push({
                        fecha: fechaStr,
                        fechaTexto: fechaFormateada,
                        horario: horarioTexto,
                        tipoHorario: tipoHorario,
                        codigoAsesor: codigoAsesor
                    });
                    localStorage.setItem('registrosBarridos2025', JSON.stringify(registros));
                    
                    const registrosAsesores = JSON.parse(localStorage.getItem('registrosAsesores2025') || '{}');
                    if (!registrosAsesores[codigoAsesor]) {
                        registrosAsesores[codigoAsesor] = [];
                    }
                    registrosAsesores[codigoAsesor].push({
                        fecha: fechaStr,
                        fechaTexto: fechaFormateada,
                        horario: horarioTexto,
                        tipoHorario: tipoHorario
                    });
                    localStorage.setItem('registrosAsesores2025', JSON.stringify(registrosAsesores));
                });
                
                actualizarResumen();
                modalHorarios.style.display = 'none';
                alert('¬°Registro exitoso! Has reservado tu cupo.');
            });
            
            modalHorarios.style.display = 'flex';
        }
        
        // Actualizar resumen de registros
        function actualizarResumen() {
            const codigoAsesor = codigoAsesorInput.value.trim();
            let registros = [];
            
            if (codigoAsesor) {
                const registrosAsesores = JSON.parse(localStorage.getItem('registrosAsesores2025') || '{}');
                registros = registrosAsesores[codigoAsesor] || [];
            }
            
            listaRegistros.innerHTML = '';
            
            if (registros.length === 0) {
                listaRegistros.innerHTML = '<p style="text-align: center; color: #777; padding: 20px;">No hay barridos seleccionados</p>';
            } else {
                registros.forEach((registro, index) => {
                    const item = document.createElement('div');
                    item.className = 'registro-item';
                    item.innerHTML = `
                        <div>
                            <strong>${registro.fechaTexto}</strong><br>
                            <small>${registro.horario}</small>
                        </div>
                        <span class="eliminar-item" data-index="${index}" data-fecha="${registro.fecha}" data-tipo="${registro.tipoHorario}">‚úï</span>
                    `;
                    listaRegistros.appendChild(item);
                });
                
                document.querySelectorAll('.eliminar-item').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        const fecha = this.getAttribute('data-fecha');
                        const tipoHorario = this.getAttribute('data-tipo');
                        const codigoAsesor = codigoAsesorInput.value.trim();
                        
                        if (!codigoAsesor) {
                            alert('Por favor ingresa tu c√≥digo de asesor');
                            return;
                        }
                        
                        const cuposBarridos = JSON.parse(localStorage.getItem('cuposBarridos2025') || '{}');
                        if (cuposBarridos[fecha]) {
                            cuposBarridos[fecha][tipoHorario] = Math.min(10, cuposBarridos[fecha][tipoHorario] + 1);
                            localStorage.setItem('cuposBarridos2025', JSON.stringify(cuposBarridos));
                        }
                        
                        const registrosGenerales = JSON.parse(localStorage.getItem('registrosBarridos2025') || '[]');
                        const nuevoRegistrosGenerales = registrosGenerales.filter(reg => 
                            !(reg.fecha === fecha && reg.tipoHorario === tipoHorario && reg.codigoAsesor === codigoAsesor)
                        );
                        localStorage.setItem('registrosBarridos2025', JSON.stringify(nuevoRegistrosGenerales));
                        
                        const registrosAsesores = JSON.parse(localStorage.getItem('registrosAsesores2025') || '{}');
                        if (registrosAsesores[codigoAsesor]) {
                            registrosAsesores[codigoAsesor].splice(index, 1);
                            localStorage.setItem('registrosAsesores2025', JSON.stringify(registrosAsesores));
                        }
                        
                        actualizarResumen();
                        generarCalendario();
                    });
                });
            }
            
            contadorRegistros.textContent = registros.length;
        }
        
        // Evento para actualizar resumen cuando cambia el c√≥digo de asesor
        codigoAsesorInput.addEventListener('input', function() {
            actualizarResumen();
        });
        
        // Eventos para los botones de navegaci√≥n del calendario
        prevMesBtn.addEventListener('click', function() {
            fechaActual.setMonth(fechaActual.getMonth() - 1);
            generarCalendario();
        });
        
        nextMesBtn.addEventListener('click', function() {
            fechaActual.setMonth(fechaActual.getMonth() + 1);
            generarCalendario();
        });
        
        // Cerrar modal
        closeModal.addEventListener('click', function() {
            modalHorarios.style.display = 'none';
        });
        
        // Funci√≥n para guardar registro completo
        function guardarRegistroCompleto(datos) {
            const registrosCompletos = JSON.parse(localStorage.getItem('registrosCompletos2025') || '[]');
            registrosCompletos.push({
                ...datos,
                fechaRegistro: new Date().toLocaleString('es-ES'),
                id: Date.now() + Math.random().toString(36).substr(2, 9)
            });
            localStorage.setItem('registrosCompletos2025', JSON.stringify(registrosCompletos));
        }
        
        // Funci√≥n para generar y descargar Excel
        function descargarExcel() {
            if (!isAuthenticated) {
                alert('No tienes permisos para realizar esta acci√≥n');
                return;
            }
            
            const registrosCompletos = JSON.parse(localStorage.getItem('registrosCompletos2025') || '[]');
            
            if (registrosCompletos.length === 0) {
                alert('No hay registros para descargar');
                return;
            }
            
            // Preparar datos para Excel
            const datosExcel = registrosCompletos.map(registro => {
                // Aplanar los registros de barridos
                const barridos = registro.registros.map(barrido => ({
                    'C√≥digo Asesor': registro.codigoAsesor,
                    'Nombre': registro.nombre,
                    'Tel√©fono': registro.telefono,
                    'Email': registro.email,
                    'Equipo': registro.equipo,
                    'Fecha Registro': registro.fechaRegistro,
                    'Fecha Barrido': barrido.fechaTexto,
                    'Horario': barrido.horario,
                    'Tipo Horario': barrido.tipoHorario
                }));
                
                return barridos;
            }).flat();
            
            // Crear libro de Excel
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(datosExcel);
            
            // A√±adir hoja al libro
            XLSX.utils.book_append_sheet(wb, ws, 'Registros Barridos');
            
            // Generar archivo y descargar
            XLSX.writeFile(wb, `Registros_Barridos_PDLP_${new Date().toISOString().slice(0,10)}.xlsx`);
        }
        
        // Funci√≥n para generar resumen por equipo
        function descargarResumenEquipos() {
            if (!isAuthenticated) {
                alert('No tienes permisos para realizar esta acci√≥n');
                return;
            }
            
            const registrosCompletos = JSON.parse(localStorage.getItem('registrosCompletos2025') || '[]');
            
            if (registrosCompletos.length === 0) {
                alert('No hay registros para generar resumen');
                return;
            }
            
            // Contar registros por equipo
            const resumenEquipos = {};
            
            registrosCompletos.forEach(registro => {
                const equipo = registro.equipo;
                if (!resumenEquipos[equipo]) {
                    resumenEquipos[equipo] = {
                        equipo: equipo,
                        totalAsesores: 0,
                        totalBarridos: 0,
                        asesores: []
                    };
                }
                
                // Contar asesores √∫nicos por equipo
                if (!resumenEquipos[equipo].asesores.includes(registro.codigoAsesor)) {
                    resumenEquipos[equipo].asesores.push(registro.codigoAsesor);
                    resumenEquipos[equipo].totalAsesores++;
                }
                
                // Contar total de barridos
                resumenEquipos[equipo].totalBarridos += registro.registros.length;
            });
            
            // Convertir a array para Excel
            const datosResumen = Object.values(resumenEquipos).map(item => ({
                'Equipo': item.equipo,
                'Total Asesores': item.totalAsesores,
                'Total Barridos': item.totalBarridos
            }));
            
            // Crear libro de Excel
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(datosResumen);
            
            // A√±adir hoja al libro
            XLSX.utils.book_append_sheet(wb, ws, 'Resumen por Equipo');
            
            // Generar archivo y descargar
            XLSX.writeFile(wb, `Resumen_Equipos_Barridos_PDLP_${new Date().toISOString().slice(0,10)}.xlsx`);
        }
        
        // Funci√≥n para buscar registros por c√≥digo de asesor
        function buscarRegistrosPorCodigo(codigo) {
            const registrosCompletos = JSON.parse(localStorage.getItem('registrosCompletos2025') || '[]');
            return registrosCompletos.filter(registro => 
                registro.codigoAsesor.toLowerCase().includes(codigo.toLowerCase())
            );
        }
        
        // Funci√≥n para eliminar registro completo
        function eliminarRegistroCompleto(id) {
            const registrosCompletos = JSON.parse(localStorage.getItem('registrosCompletos2025') || '[]');
            const registroEliminado = registrosCompletos.find(registro => registro.id === id);
            
            if (!registroEliminado) {
                alert('No se encontr√≥ el registro a eliminar');
                return false;
            }
            
            // Restaurar cupos para cada barrido eliminado
            registroEliminado.registros.forEach(barrido => {
                const fechaStr = barrido.fecha;
                const tipoHorario = barrido.tipoHorario;
                
                const cuposBarridos = JSON.parse(localStorage.getItem('cuposBarridos2025') || '{}');
                if (cuposBarridos[fechaStr]) {
                    cuposBarridos[fechaStr][tipoHorario] = Math.min(10, cuposBarridos[fechaStr][tipoHorario] + 1);
                    localStorage.setItem('cuposBarridos2025', JSON.stringify(cuposBarridos));
                }
            });
            
            // Eliminar de registros generales
            const registrosGenerales = JSON.parse(localStorage.getItem('registrosBarridos2025') || '[]');
            const nuevoRegistrosGenerales = registrosGenerales.filter(reg => 
                !registroEliminado.registros.some(barrido => 
                    barrido.fecha === reg.fecha && 
                    barrido.tipoHorario === reg.tipoHorario && 
                    barrido.codigoAsesor === reg.codigoAsesor
                )
            );
            localStorage.setItem('registrosBarridos2025', JSON.stringify(nuevoRegistrosGenerales));
            
            // Eliminar de registros de asesores
            const registrosAsesores = JSON.parse(localStorage.getItem('registrosAsesores2025') || '{}');
            if (registrosAsesores[registroEliminado.codigoAsesor]) {
                delete registrosAsesores[registroEliminado.codigoAsesor];
                localStorage.setItem('registrosAsesores2025', JSON.stringify(registrosAsesores));
            }
            
            // Eliminar de registros completos
            const nuevosRegistrosCompletos = registrosCompletos.filter(registro => registro.id !== id);
            localStorage.setItem('registrosCompletos2025', JSON.stringify(nuevosRegistrosCompletos));
            
            return true;
        }
        
        // Funci√≥n para eliminar registro por c√≥digo de asesor (eliminaci√≥n r√°pida)
        function eliminarRegistroPorCodigo(codigo) {
            if (!isAuthenticated) {
                alert('No tienes permisos para realizar esta acci√≥n');
                return;
            }
            
            if (!codigo) {
                alert('Por favor ingresa un c√≥digo de asesor');
                return;
            }
            
            const registrosEncontrados = buscarRegistrosPorCodigo(codigo);
            
            if (registrosEncontrados.length === 0) {
                alert('No se encontraron registros con ese c√≥digo');
                return;
            }
            
            if (registrosEncontrados.length > 1) {
                alert(`Se encontraron ${registrosEncontrados.length} registros con ese c√≥digo. Usa la opci√≥n de b√∫squeda avanzada para seleccionar cu√°l eliminar.`);
                return;
            }
            
            const registro = registrosEncontrados[0];
            
            if (confirm(`¬øEst√°s seguro de que deseas eliminar el registro de ${registro.nombre} (${registro.codigoAsesor})? Esta acci√≥n no se puede deshacer.`)) {
                if (eliminarRegistroCompleto(registro.id)) {
                    alert('‚úÖ Registro eliminado correctamente');
                    codigoEliminarInput.value = '';
                    generarCalendario();
                } else {
                    alert('‚ùå Error al eliminar el registro');
                }
            }
        }
        
        // Funci√≥n para resetear cupos de un d√≠a espec√≠fico
        function resetearCuposDia(dia) {
            if (!isAuthenticated) {
                alert('No tienes permisos para realizar esta acci√≥n');
                return;
            }
            
            const fechaStr = `2025-11-${dia.toString().padStart(2, '0')}`;
            const cuposBarridos = JSON.parse(localStorage.getItem('cuposBarridos2025') || '{}');
            
            cuposBarridos[fechaStr] = {
                manana: 10,
                tarde: 10
            };
            
            localStorage.setItem('cuposBarridos2025', JSON.stringify(cuposBarridos));
            
            // Tambi√©n eliminar registros de ese d√≠a
            const registrosBarridos = JSON.parse(localStorage.getItem('registrosBarridos2025') || '[]');
            const nuevosRegistrosBarridos = registrosBarridos.filter(reg => reg.fecha !== fechaStr);
            localStorage.setItem('registrosBarridos2025', JSON.stringify(nuevosRegistrosBarridos));
            
            // Actualizar registros de asesores
            const registrosAsesores = JSON.parse(localStorage.getItem('registrosAsesores2025') || '{}');
            for (const codigo in registrosAsesores) {
                if (registrosAsesores.hasOwnProperty(codigo)) {
                    registrosAsesores[codigo] = registrosAsesores[codigo].filter(reg => reg.fecha !== fechaStr);
                    if (registrosAsesores[codigo].length === 0) {
                        delete registrosAsesores[codigo];
                    }
                }
            }
            localStorage.setItem('registrosAsesores2025', JSON.stringify(registrosAsesores));
            
            // Actualizar registros completos
            const registrosCompletos = JSON.parse(localStorage.getItem('registrosCompletos2025') || '[]');
            const nuevosRegistrosCompletos = registrosCompletos.map(registro => {
                return {
                    ...registro,
                    registros: registro.registros.filter(barrido => barrido.fecha !== fechaStr)
                };
            }).filter(registro => registro.registros.length > 0);
            localStorage.setItem('registrosCompletos2025', JSON.stringify(nuevosRegistrosCompletos));
            
            generarCalendario();
            alert(`‚úÖ Cupos del d√≠a ${dia} de noviembre restablecidos correctamente`);
        }
        
        // Funci√≥n para resetear todos los cupos
        function resetearTodosLosCupos() {
            if (!isAuthenticated) {
                alert('No tienes permisos para realizar esta acci√≥n');
                return;
            }
            
            if (confirm('¬øEst√°s seguro de que deseas restablecer TODOS los cupos a su estado inicial? Esta acci√≥n eliminar√° todos los registros y no se puede deshacer.')) {
                // Eliminar todos los datos de localStorage
                localStorage.removeItem('cuposBarridos2025');
                localStorage.removeItem('registrosBarridos2025');
                localStorage.removeItem('registrosAsesores2025');
                localStorage.removeItem('registrosCompletos2025');
                
                // Inicializar cupos nuevamente
                inicializarCupos();
                
                generarCalendario();
                alert('‚úÖ Todos los cupos han sido restablecidos correctamente');
            }
        }

        // EVENTO PARA EL BOT√ìN DE REGISTRO MODIFICADO
        // EVENTO PARA EL BOT√ìN DE REGISTRO MODIFICADO - CORREGIDO
registroBtn.addEventListener('click', async function() {
    const nombre = document.getElementById('nombre').value;
    const telefono = document.getElementById('telefono').value;
    const email = document.getElementById('email').value;
    const codigoAsesor = codigoAsesorInput.value.trim();
    const equipo = equipoSelect.value;
    const confirmacion = document.getElementById('confirmacion').checked;
    
    if (!nombre || !telefono || !email || !codigoAsesor || !equipo) {
        alert('Por favor completa todos los campos obligatorios');
        return;
    }
    
    if (!validarTelefono(telefono)) {
        alert('Por favor ingresa un n√∫mero de tel√©fono v√°lido (10 d√≠gitos que comienzan con 0)');
        telefonoInput.focus();
        return;
    }
    
    if (!confirmacion) {
        alert('Debes confirmar que asistir√°s a los barridos seleccionados');
        return;
    }
    
    const registrosAsesores = JSON.parse(localStorage.getItem('registrosAsesores2025') || '{}');
    const registros = registrosAsesores[codigoAsesor] || [];
    
    if (registros.length === 0) {
        alert('Por favor selecciona al menos un barrido en el calendario');
        return;
    }
    
    // Mostrar mensaje de carga
    registroBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> REGISTRANDO...';
    registroBtn.disabled = true;
    
    // Preparar datos para guardar (fuera del try para que est√© disponible en catch)
    const datosRegistro = {
        codigoAsesor: codigoAsesor,
        nombre: nombre,
        telefono: telefono,
        email: email,
        equipo: equipo,
        registros: registros
    };
    
    try {
        // Guardar registro en Google Sheets
        const resultado = await (datosRegistro);
        
        if (resultado.success) {
            // Guardar registro completo localmente tambi√©n
            guardarRegistroCompleto(datosRegistro);
            
            alert(`‚úÖ ¬°Registro exitoso!\n\nTe has registrado para ${registros.length} barrido(s).\n\nLos datos han sido guardados en el sistema.`);
            
            // Limpiar formulario
            document.getElementById('nombre').value = '';
            document.getElementById('telefono').value = '';
            document.getElementById('email').value = '';
            codigoAsesorInput.value = '';
            equipoSelect.value = '';
            document.getElementById('confirmacion').checked = false;
            
            // Limpiar registros locales
            const registrosAsesores = JSON.parse(localStorage.getItem('registrosAsesores2025') || '{}');
            delete registrosAsesores[codigoAsesor];
            localStorage.setItem('registrosAsesores2025', JSON.stringify(registrosAsesores));
            
            actualizarResumen();
            generarCalendario();
            
        } else {
            throw new Error(resultado.message || 'Error al guardar en Google Sheets');
        }
        
    } catch (error) {
        console.error('Error al guardar registro:', error);
        
        // Intentar guardar localmente como respaldo
        try {
            guardarRegistroCompleto(datosRegistro);
            alert(`‚ö†Ô∏è Se guard√≥ localmente pero hubo un problema con el servidor.\n\nTe has registrado para ${registros.length} barrido(s).\n\nError: ${error.message}`);
        } catch (backupError) {
            console.error('Error en respaldo local:', backupError);
            alert('‚ùå Error cr√≠tico al guardar el registro. Por favor contacta al administrador.');
        }
    } finally {
        // Restaurar bot√≥n siempre
        registroBtn.innerHTML = '<i class="fas fa-calendar-check"></i> REGISTRARME';
        registroBtn.disabled = false;
    }
});

        // Funci√≥n para guardar registro completo - VERIFICAR QUE EXISTA
function guardarRegistroCompleto(datos) {
    try {
        const registrosCompletos = JSON.parse(localStorage.getItem('registrosCompletos2025') || '[]');
        registrosCompletos.push({
            ...datos,
            fechaRegistro: new Date().toLocaleString('es-ES'),
            id: Date.now() + Math.random().toString(36).substr(2, 9)
        });
        localStorage.setItem('registrosCompletos2025', JSON.stringify(registrosCompletos));
        return true;
    } catch (error) {
        console.error('Error en guardarRegistroCompleto:', error);
        return false;
    }
}

        // Funci√≥n temporal para debugging
function debugRegistro() {
    const registrosCompletos = JSON.parse(localStorage.getItem('registrosCompletos2025') || '[]');
    console.log('Registros completos en localStorage:', registrosCompletos);
    console.log('Registros asesores en localStorage:', JSON.parse(localStorage.getItem('registrosAsesores2025') || '{}'));
}
        
        // Eventos para los botones de descarga
        descargarRegistrosBtn.addEventListener('click', descargarExcel);
        descargarResumenBtn.addEventListener('click', descargarResumenEquipos);
        
        // Evento para el bot√≥n de eliminar registro
        eliminarRegistroBtn.addEventListener('click', function() {
            if (!isAuthenticated) {
                alert('No tienes permisos para realizar esta acci√≥n');
                return;
            }
            
            eliminarRegistroModal.style.display = 'flex';
            buscarCodigoInput.value = '';
            resultadosBusqueda.innerHTML = '';
        });
        
        // Evento para buscar registros
        buscarRegistroBtn.addEventListener('click', function() {
            const codigo = buscarCodigoInput.value.trim();
            
            if (!codigo) {
                alert('Por favor ingresa un c√≥digo de asesor para buscar');
                return;
            }
            
            const registrosEncontrados = buscarRegistrosPorCodigo(codigo);
            
            if (registrosEncontrados.length === 0) {
                resultadosBusqueda.innerHTML = '<p style="text-align: center; color: #777; padding: 10px;">No se encontraron registros con ese c√≥digo</p>';
                return;
            }
            
            resultadosBusqueda.innerHTML = '';
            
            registrosEncontrados.forEach(registro => {
                const item = document.createElement('div');
                item.className = 'registro-item';
                item.style.border = '1px solid #ddd';
                item.style.borderRadius = '8px';
                item.style.padding = '10px';
                item.style.marginBottom = '10px';
                item.style.backgroundColor = '#f9f9f9';
                
                item.innerHTML = `
                    <div style="flex-grow: 1;">
                        <strong>C√≥digo: ${registro.codigoAsesor}</strong><br>
                        <strong>Nombre: ${registro.nombre}</strong><br>
                        <small>Tel√©fono: ${registro.telefono}</small><br>
                        <small>Equipo: ${registro.equipo}</small><br>
                        <small>Fecha de registro: ${registro.fechaRegistro}</small><br>
                        <small>Barridos registrados: ${registro.registros.length}</small>
                        <div style="margin-top: 8px;">
                            ${registro.registros.map(barrido => 
                                `<div style="font-size: 0.8rem; background: #e0f2f1; padding: 3px 6px; border-radius: 4px; margin: 2px 0;">${barrido.fechaTexto} - ${barrido.horario}</div>`
                            ).join('')}
                        </div>
                    </div>
                    <button class="eliminar-item" data-id="${registro.id}" style="background: #e74c3c; color: white; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer; font-size: 0.9rem;">
                        <i class="fas fa-trash"></i> Eliminar
                    </button>
                `;
                
                resultadosBusqueda.appendChild(item);
            });
            
            // Agregar eventos a los botones de eliminar
            document.querySelectorAll('.eliminar-item[data-id]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    
                    if (confirm('¬øEst√°s seguro de que deseas eliminar este registro? Esta acci√≥n no se puede deshacer.')) {
                        if (eliminarRegistroCompleto(id)) {
                            alert('‚úÖ Registro eliminado correctamente');
                            eliminarRegistroModal.style.display = 'none';
                            generarCalendario();
                        } else {
                            alert('‚ùå Error al eliminar el registro');
                        }
                    }
                });
            });
        });
        
        // Evento para eliminaci√≥n r√°pida
        btnEliminarRapido.addEventListener('click', function() {
            const codigo = codigoEliminarInput.value.trim();
            eliminarRegistroPorCodigo(codigo);
        });
        
        // Evento para reseteo de cupos por d√≠a
        reseteoCuposDiaBtn.addEventListener('click', function() {
            if (!isAuthenticated) {
                alert('No tienes permisos para realizar esta acci√≥n');
                return;
            }
            
            // Llenar el select con los d√≠as disponibles
            diaReseteoSelect.innerHTML = '<option value="">-- Selecciona un d√≠a --</option>';
            diasConBarridos.forEach(dia => {
                const option = document.createElement('option');
                option.value = dia;
                option.textContent = `${dia} de noviembre`;
                diaReseteoSelect.appendChild(option);
            });
            
            reseteoCuposModal.style.display = 'flex';
        });
        
        // Evento para reseteo completo de cupos
        reseteoCuposCompletoBtn.addEventListener('click', function() {
            resetearTodosLosCupos();
        });
        
        // Evento para confirmar reseteo de cupos por d√≠a
        confirmarReseteo.addEventListener('click', function() {
            const dia = parseInt(diaReseteoSelect.value);
            
            if (!dia) {
                alert('Por favor selecciona un d√≠a');
                return;
            }
            
            resetearCuposDia(dia);
            reseteoCuposModal.style.display = 'none';
        });
        
        // Eventos para autenticaci√≥n
        adminAccessBtn.addEventListener('click', function() {
            if (isAuthenticated) {
                // Si ya est√° autenticado, mostrar opci√≥n de cerrar sesi√≥n
                if (confirm('¬øDeseas cerrar la sesi√≥n administrativa?')) {
                    logoutAdmin();
                }
            } else {
                // Si no est√° autenticado, mostrar modal de autenticaci√≥n
                adminAuthModal.style.display = 'flex';
                adminPasswordInput.value = '';
                adminPasswordInput.focus();
            }
        });
        
        closeAuthModal.addEventListener('click', function() {
            adminAuthModal.style.display = 'none';
        });
        
        cancelAuth.addEventListener('click', function() {
            adminAuthModal.style.display = 'none';
        });
        
        submitAuth.addEventListener('click', function() {
            const password = adminPasswordInput.value;
            
            if (password === ADMIN_PASSWORD) {
                isAuthenticated = true;
                localStorage.setItem('adminAuth2025', 'true');
                adminAuthModal.style.display = 'none';
                showAdminSection();
                alert('‚úÖ Acceso administrativo concedido');
            } else {
                alert('‚ùå Contrase√±a incorrecta');
                adminPasswordInput.value = '';
                adminPasswordInput.focus();
            }
        });
        
        // Cerrar modal de eliminar registro
        closeEliminarModal.addEventListener('click', function() {
            eliminarRegistroModal.style.display = 'none';
        });
        
        cancelarEliminar.addEventListener('click', function() {
            eliminarRegistroModal.style.display = 'none';
        });
        
        // Cerrar modal de reseteo de cupos
        closeReseteoModal.addEventListener('click', function() {
            reseteoCuposModal.style.display = 'none';
        });
        
        cancelarReseteo.addEventListener('click', function() {
            reseteoCuposModal.style.display = 'none';
        });
        
        // Permitir enviar con Enter
        adminPasswordInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                submitAuth.click();
            }
        });
        
        buscarCodigoInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                buscarRegistroBtn.click();
            }
        });
        
        codigoEliminarInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                btnEliminarRapido.click();
            }
        });
        
        // Evento para cerrar sesi√≥n
        cerrarSesionBtn.addEventListener('click', function() {
            logoutAdmin();
        });
        
        // Inicializar
        inicializarCupos();
        generarCalendario();
        actualizarResumen();
        checkAuthStatus(); // Verificar estado de autenticaci√≥n al cargar
    });
</script>
</body>
</html>
